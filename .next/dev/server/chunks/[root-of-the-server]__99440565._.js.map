{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 214, "column": 0}, "map": {"version":3,"sources":["file:///Users/Zhuanz/Projects/gzh_fav/app/api/fetch/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport * as cheerio from 'cheerio';\nimport * as fs from 'fs';\nimport * as path from 'path';\nimport { createHash } from 'crypto';\n\ninterface Article {\n  id: string;\n  url: string;\n  title: string;\n  author: string;\n  content: string;\n  publishedAt: string;\n  collectedAt: string;\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const { url } = await request.json();\n\n    if (!url) {\n      return NextResponse.json({ error: 'URL is required' }, { status: 400 });\n    }\n\n    // Fetch the article\n    const response = await fetch(url, {\n      headers: {\n        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36'\n      }\n    });\n    if (!response.ok) {\n      return NextResponse.json({ error: 'Failed to fetch article' }, { status: 500 });\n    }\n    const html = await response.text();\n\n    // Parse HTML\n    const $ = cheerio.load(html);\n\n    const title = $('#activity-name').text().trim() || $('title').text().trim() || 'Unknown Title';\n    const author = $('#js_name').text().trim() || $('#profileBt a').text().trim() || 'Unknown Author';\n    const publishedAt = $('meta[property=\"article:published_time\"]').attr('content') || $('#publish_time').text().trim() || new Date().toISOString();\n    const contentHtml = $('#js_content').html() || '';\n\n    // Clean content\n    const content = contentHtml.replace(/<script[\\s\\S]*?<\\/script>/gi, '').trim();\n\n    // Generate short ID\n    const id = createHash('md5').update(url).digest('hex').substring(0, 6);\n\n    const article: Article = {\n      id,\n      url,\n      title,\n      author,\n      content,\n      publishedAt,\n      collectedAt: new Date().toISOString(),\n    };\n\n    // Save to JSON file\n    const filePath = path.join(process.cwd(), 'data', 'articles.json');\n    let articles: Article[] = [];\n    if (fs.existsSync(filePath)) {\n      const data = fs.readFileSync(filePath, 'utf8');\n      articles = JSON.parse(data);\n    }\n    articles.push(article);\n    fs.writeFileSync(filePath, JSON.stringify(articles, null, 2));\n\n    return NextResponse.json({ shortLink: `/${id}`, article });\n  } catch (error) {\n    console.error('Error fetching article:', error);\n    return NextResponse.json({ error: 'Failed to fetch article' }, { status: 500 });\n  }\n}"],"names":[],"mappings":";;;;AAAA;AACA;AAAA;AACA;AACA;AACA;;;;;;AAYO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,EAAE,GAAG,EAAE,GAAG,MAAM,QAAQ,IAAI;QAElC,IAAI,CAAC,KAAK;YACR,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAkB,GAAG;gBAAE,QAAQ;YAAI;QACvE;QAEA,oBAAoB;QACpB,MAAM,WAAW,MAAM,MAAM,KAAK;YAChC,SAAS;gBACP,cAAc;YAChB;QACF;QACA,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA0B,GAAG;gBAAE,QAAQ;YAAI;QAC/E;QACA,MAAM,OAAO,MAAM,SAAS,IAAI;QAEhC,aAAa;QACb,MAAM,IAAI,iKAAY,CAAC;QAEvB,MAAM,QAAQ,EAAE,kBAAkB,IAAI,GAAG,IAAI,MAAM,EAAE,SAAS,IAAI,GAAG,IAAI,MAAM;QAC/E,MAAM,SAAS,EAAE,YAAY,IAAI,GAAG,IAAI,MAAM,EAAE,gBAAgB,IAAI,GAAG,IAAI,MAAM;QACjF,MAAM,cAAc,EAAE,2CAA2C,IAAI,CAAC,cAAc,EAAE,iBAAiB,IAAI,GAAG,IAAI,MAAM,IAAI,OAAO,WAAW;QAC9I,MAAM,cAAc,EAAE,eAAe,IAAI,MAAM;QAE/C,gBAAgB;QAChB,MAAM,UAAU,YAAY,OAAO,CAAC,+BAA+B,IAAI,IAAI;QAE3E,oBAAoB;QACpB,MAAM,KAAK,IAAA,mHAAU,EAAC,OAAO,MAAM,CAAC,KAAK,MAAM,CAAC,OAAO,SAAS,CAAC,GAAG;QAEpE,MAAM,UAAmB;YACvB;YACA;YACA;YACA;YACA;YACA;YACA,aAAa,IAAI,OAAO,WAAW;QACrC;QAEA,oBAAoB;QACpB,MAAM,WAAW,yGAAS,CAAC,QAAQ,GAAG,IAAI,QAAQ;QAClD,IAAI,WAAsB,EAAE;QAC5B,IAAI,2GAAa,CAAC,WAAW;YAC3B,MAAM,OAAO,6GAAe,CAAC,UAAU;YACvC,WAAW,KAAK,KAAK,CAAC;QACxB;QACA,SAAS,IAAI,CAAC;QACd,8GAAgB,CAAC,UAAU,KAAK,SAAS,CAAC,UAAU,MAAM;QAE1D,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,WAAW,CAAC,CAAC,EAAE,IAAI;YAAE;QAAQ;IAC1D,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,2BAA2B;QACzC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA0B,GAAG;YAAE,QAAQ;QAAI;IAC/E;AACF"}}]
}